<launch>

	<!--LASER - Iniciando os nós do LASER Velodyne e iniciando o nó da funcão de transferência do Laser para o mapa estático-->

		<!-- start nodelet manager and driver nodelets -->
		<include file="$(find velodyne_driver)/launch/nodelet_manager.launch" />

		<!-- start cloud nodelet -->
		<include file="$(find velodyne_pointcloud)/launch/cloud_nodelet.launch">
			<arg name="calibration"
			 value="$(find velodyne_pointcloud)/params/64e_utexas.yaml"/>
			<arg name="min_range"
			 value="0.001"/>
		</include>


		<node pkg="tf" type="static_transform_publisher" name="simple_tf_laser_broadcaster_node" args="0 0 0 0 0 0 velodyne map 100" />


	<!--KINECT - Iniciando os nós do KINECT referentes a depth e iniciando o nó da funcão de transferência do Kinect para o mapa estático-->

		<include file="/opt/ros/indigo/share/freenect_launch/launch/freenect.launch">
			<arg name="rgb_processing"                  value="false" />
			<arg name="ir_processing"                   value="false" />
			<arg name="depth_registered_processing"     value="false" />
			<arg name="disparity_processing"            value="false" />
			<arg name="disparity_registered_processing" value="false" />
		</include>


		<node pkg="tf" type="static_transform_publisher" name="simple_tf_kinect_broadcaster_node" args="0 0.4 0 0 0 1.57079632679 camera_depth_optical_frame map 100" />


	<!--RELAY - Nó responsável por republicar os dados de pointcloud do Velodyne no tópico de pointcloud do Kinect-->
		<!--Este passo foi adicionado porque se utilizarmos dois remaps para o octomap_server (um do velodyne para o cloud_in e outro do kynect para o cloud_in) eles se sobreescreviam-->

		<node pkg="topic_tools" type="relay" name="relay_velodyne_to_kinect_" args="/velodyne_points /camera/depth/points">
			<param name="unreliable" type="bool" value="false" />
			<param name="lazy" type="bool" value="true" />
		</node>


	<!--OCTOMAP SERVER-->

		<node pkg="octomap_server" type="octomap_server_node" name="octomap_server_node_laser" output='screen'>
			<param name="frame_id" type="string" value="/map" />
			<param name="resolution" value="0.05" />
			<param name="height_map" type="bool" value="true" />
			<param name="sensor_model/max_range" value="-1" />
			<param name="latch" type="bool"  value="false" />
			<param name="sensor_model/max_range" value="100.0" />

			<remap from="cloud_in" to="/camera/depth/points" />

			<!--Este segundo remap está sobreescrevendo o 1o. Por esse motivo, utilizamos o relay-->
			<!--<remap from="cloud_in" to="/velodyne_points" />-->

		</node>

</launch>
